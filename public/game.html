<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Sweet Lab - Juego de Premios</title>
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="/styles.css" />
	<style>
		/* Game-specific styles */
		body {
			background: linear-gradient(135deg, #fdf7f8 0%, #f4a6b7 100%);
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 20px;
			position: relative;
			overflow-x: hidden;
		}

		/* Animated background particles */
		.bg-particles {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 0;
			overflow: hidden;
		}

		.particle {
			position: absolute;
			width: 10px;
			height: 10px;
			background: rgba(244, 166, 183, 0.3);
			border-radius: 50%;
			animation: float 15s infinite ease-in-out;
		}

		.particle:nth-child(1) {
			left: 10%;
			animation-delay: 0s;
		}

		.particle:nth-child(2) {
			left: 20%;
			animation-delay: 2s;
		}

		.particle:nth-child(3) {
			left: 30%;
			animation-delay: 4s;
		}

		.particle:nth-child(4) {
			left: 40%;
			animation-delay: 1s;
		}

		.particle:nth-child(5) {
			left: 50%;
			animation-delay: 3s;
		}

		.particle:nth-child(6) {
			left: 60%;
			animation-delay: 5s;
		}

		.particle:nth-child(7) {
			left: 70%;
			animation-delay: 2.5s;
		}

		.particle:nth-child(8) {
			left: 80%;
			animation-delay: 4.5s;
		}

		.particle:nth-child(9) {
			left: 90%;
			animation-delay: 1.5s;
		}

		@keyframes float {

			0%,
			100% {
				transform: translateY(100vh) scale(0);
				opacity: 0;
			}

			10% {
				opacity: 1;
			}

			90% {
				opacity: 1;
			}

			100% {
				transform: translateY(-100px) scale(1);
				opacity: 0;
			}
		}

		.game-container {
			position: relative;
			z-index: 1;
			max-width: 600px;
			width: 100%;
			margin: 0 auto;
		}

		.game-header {
			text-align: center;
			margin-bottom: 30px;
		}

		.game-logo {
			width: 120px;
			height: auto;
			margin-bottom: 20px;
			filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));
			background: transparent;
			mix-blend-mode: multiply;
		}

		.game-title {
			font-size: 32px;
			font-weight: 700;
			color: #2a2a2a;
			margin: 0 0 10px 0;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.game-subtitle {
			font-size: 16px;
			color: #5a5a5a;
			margin: 0;
		}

		/* Glass card effect */
		.glass-card {
			background: rgba(255, 255, 255, 0.9);
			backdrop-filter: blur(10px);
			border-radius: 24px;
			padding: 40px;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.5);
		}

		/* Registration Form */
		.registration-section {
			display: block;
		}

		.registration-section.hidden {
			display: none;
		}

		.form-group {
			margin-bottom: 20px;
		}

		.form-label {
			display: block;
			font-size: 14px;
			font-weight: 600;
			color: #2a2a2a;
			margin-bottom: 8px;
		}

		.form-input,
		.form-select {
			width: 100%;
			padding: 14px 18px;
			border: 2px solid #e5e7eb;
			border-radius: 12px;
			font-size: 16px;
			font-family: 'DM Sans', sans-serif;
			background: white;
			color: #2a2a2a;
			transition: all 0.3s ease;
		}

		.form-input:focus,
		.form-select:focus {
			outline: none;
			border-color: #f4a6b7;
			box-shadow: 0 0 0 4px rgba(244, 166, 183, 0.1);
		}

		.form-input::placeholder {
			color: #9ca3af;
		}

		.error-message {
			display: none;
			color: #ef4444;
			font-size: 12px;
			margin-top: 6px;
		}

		.error-message.show {
			display: block;
		}

		.btn-primary {
			width: 100%;
			padding: 16px;
			background: linear-gradient(135deg, #f4a6b7 0%, #e27a90 100%);
			color: white;
			border: none;
			border-radius: 12px;
			font-size: 18px;
			font-weight: 700;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 4px 16px rgba(244, 166, 183, 0.4);
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 24px rgba(244, 166, 183, 0.6);
		}

		.btn-primary:active {
			transform: translateY(0);
		}

		.btn-primary:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}

		/* Game Section */
		.game-section {
			display: none;
			text-align: center;
		}

		.game-section.active {
			display: block;
		}

		.wheel-container {
			position: relative;
			width: 100%;
			max-width: 400px;
			margin: 0 auto 30px;
		}

		.wheel-wrapper {
			position: relative;
			width: 100%;
			padding-bottom: 100%;
		}

		.wheel {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			border-radius: 50%;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
			transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
		}

		.wheel-pointer {
			position: absolute;
			top: -20px;
			left: 50%;
			transform: translateX(-50%);
			width: 0;
			height: 0;
			border-left: 20px solid transparent;
			border-right: 20px solid transparent;
			border-top: 40px solid #2a2a2a;
			filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
			z-index: 10;
		}

		.wheel-center {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 80px;
			height: 80px;
			background: white;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
			z-index: 5;
			font-size: 12px;
			font-weight: 700;
			color: #f4a6b7;
			text-align: center;
			padding: 10px;
		}

		.btn-spin {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			padding: 16px 40px;
			background: linear-gradient(135deg, #f4a6b7 0%, #e27a90 100%);
			color: white;
			border: none;
			border-radius: 50px;
			font-size: 18px;
			font-weight: 700;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 6px 24px rgba(244, 166, 183, 0.4);
			text-transform: uppercase;
			letter-spacing: 2px;
			z-index: 10;
		}

		.btn-spin:hover:not(:disabled) {
			transform: translate(-50%, -50%) scale(1.05);
			box-shadow: 0 8px 32px rgba(244, 166, 183, 0.6);
		}

		.btn-spin:active:not(:disabled) {
			transform: translate(-50%, -50%) scale(0.95);
		}

		.btn-spin:disabled {
			opacity: 0.5;
			cursor: not-allowed;
			pointer-events: none;
		}

		/* Prize Display */
		.prize-section {
			display: none;
			text-align: center;
		}

		.prize-section.active {
			display: block;
			animation: fadeInUp 0.6s ease;
		}

		@keyframes fadeInUp {
			from {
				opacity: 0;
				transform: translateY(30px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.prize-icon {
			font-size: 80px;
			margin-bottom: 20px;
			animation: bounce 1s ease infinite;
		}

		@keyframes bounce {

			0%,
			100% {
				transform: translateY(0);
			}

			50% {
				transform: translateY(-10px);
			}
		}

		.prize-title {
			font-size: 28px;
			font-weight: 700;
			color: #2a2a2a;
			margin: 0 0 10px 0;
		}

		.prize-value {
			font-size: 48px;
			font-weight: 700;
			background: linear-gradient(135deg, #f4a6b7 0%, #e27a90 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			margin: 10px 0 20px 0;
		}

		.prize-message {
			font-size: 16px;
			color: #5a5a5a;
			margin-bottom: 30px;
		}

		/* Confetti */
		.confetti-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 1000;
			overflow: hidden;
		}

		.confetti {
			position: absolute;
			width: 10px;
			height: 10px;
			background: #f4a6b7;
			animation: confetti-fall 3s linear forwards;
		}

		@keyframes confetti-fall {
			to {
				transform: translateY(100vh) rotate(360deg);
				opacity: 0;
			}
		}

		/* Loading spinner */
		.spinner {
			display: inline-block;
			width: 20px;
			height: 20px;
			border: 3px solid rgba(255, 255, 255, 0.3);
			border-top-color: white;
			border-radius: 50%;
			animation: spin 0.8s linear infinite;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		/* Mobile responsive */
		@media (max-width: 600px) {
			.glass-card {
				padding: 24px;
			}

			.game-title {
				font-size: 24px;
			}

			.game-subtitle {
				font-size: 14px;
			}

			.wheel-container {
				max-width: 300px;
			}

			.prize-value {
				font-size: 36px;
			}
		}
	</style>
</head>

<body>
	<!-- Background particles -->
	<div class="bg-particles">
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
		<div class="particle"></div>
	</div>

	<!-- Main game container -->
	<div class="game-container">
		<!-- Header -->
		<div class="game-header">
			<img src="/logo.png" alt="Sweet Lab Logo" class="game-logo" />
			<h1 class="game-title">üéâ Gira y Gana üéâ</h1>
			<p class="game-subtitle">¬°Participa y gana descuentos incre√≠bles o un postre gratis!</p>
		</div>

		<!-- Registration Section -->
		<div class="registration-section glass-card" id="registration-section">
			<form id="registration-form">
				<div class="form-group">
					<label class="form-label" for="customer-name">Nombre Completo</label>
					<input type="text" id="customer-name" class="form-input" placeholder="Ej: Mar√≠a Garc√≠a" required />
					<div class="error-message" id="name-error">Por favor ingresa tu nombre completo</div>
				</div>

				<div class="form-group">
					<label class="form-label" for="customer-whatsapp">WhatsApp</label>
					<input type="tel" id="customer-whatsapp" class="form-input" placeholder="Ej: 3001234567" required />
					<div class="error-message" id="whatsapp-error">Por favor ingresa un n√∫mero v√°lido</div>
				</div>

				<div class="form-group">
					<label class="form-label" for="seller-name">¬øQui√©n te atendi√≥?</label>
					<select id="seller-name" class="form-select" required>
						<option value="">Selecciona un vendedor</option>
					</select>
					<div class="error-message" id="seller-error">Por favor selecciona un vendedor</div>
				</div>

				<button type="submit" class="btn-primary" id="submit-btn">
					Comenzar a Jugar
				</button>
			</form>
		</div>

		<!-- Game Section -->
		<div class="game-section glass-card" id="game-section">
			<div class="wheel-container">
				<div class="wheel-pointer"></div>
				<div class="wheel-wrapper">
					<canvas id="wheel-canvas" class="wheel" width="400" height="400"></canvas>
				</div>
				<button class="btn-spin" id="spin-btn">¬°GIRAR!</button>
			</div>
		</div>

		<!-- Prize Section -->
		<div class="prize-section glass-card" id="prize-section">
			<div class="prize-icon" id="prize-icon">üéÅ</div>
			<h2 class="prize-title">¬°Felicitaciones!</h2>
			<div class="prize-value" id="prize-value">50% DESC</div>
			<p class="prize-message" id="prize-message">
				Has ganado un descuento incre√≠ble. Muestra este resultado a tu vendedor para aplicarlo.
			</p>
		</div>
	</div>

	<!-- Confetti container -->
	<div class="confetti-container" id="confetti-container"></div>

	<script>
		// Game state
		let gameState = {
			customerName: '',
			whatsapp: '',
			sellerName: '',
			hasPlayed: false,
			prize: null
		};

		// ===== CONFIGURACI√ìN DE PROBABILIDADES =====
		// Ajusta estos n√∫meros para cambiar las probabilidades de cada premio
		// El total debe sumar 100
		const PROBABILITIES = {
			'POSTRE GRATIS': 5,   // 5% de probabilidad
			'70% DESC': 2,        // 2% de probabilidad
			'50% DESC': 5,        // 5% de probabilidad
			'30% DESC': 10,       // 10% de probabilidad
			'25% DESC': 10,       // 10% de probabilidad
			'20% DESC': 15,       // 15% de probabilidad
			'15% DESC': 15,       // 15% de probabilidad
			'10% DESC': 20,       // 20% de probabilidad
			'5% DESC': 13,        // 13% de probabilidad
			'0% DESC': 5          // 5% de probabilidad
		};

		// Prize configuration (for backend) - usando probabilidades configurables
		const prizes = [
			{ type: 'free', label: 'POSTRE GRATIS', value: 'üéÇ', probability: PROBABILITIES['POSTRE GRATIS'], color: '#ff6b9d' },
			{ type: 'discount', label: '70% DESC', value: '70%', probability: PROBABILITIES['70% DESC'], color: '#f43f5e' },
			{ type: 'discount', label: '50% DESC', value: '50%', probability: PROBABILITIES['50% DESC'], color: '#ec4899' },
			{ type: 'discount', label: '30% DESC', value: '30%', probability: PROBABILITIES['30% DESC'], color: '#f472b6' },
			{ type: 'discount', label: '25% DESC', value: '25%', probability: PROBABILITIES['25% DESC'], color: '#f472b6' },
			{ type: 'discount', label: '20% DESC', value: '20%', probability: PROBABILITIES['20% DESC'], color: '#f9a8d4' },
			{ type: 'discount', label: '15% DESC', value: '15%', probability: PROBABILITIES['15% DESC'], color: '#f9a8d4' },
			{ type: 'discount', label: '10% DESC', value: '10%', probability: PROBABILITIES['10% DESC'], color: '#fbcfe8' },
			{ type: 'discount', label: '5% DESC', value: '5%', probability: PROBABILITIES['5% DESC'], color: '#fce7f3' },
			{ type: 'discount', label: '0% DESC', value: '0%', probability: PROBABILITIES['0% DESC'], color: '#fce7f3' }
		];

		// Wheel segments - exactly 10 with shuffled order (colores m√°s claros que #ff6b9d)
		const wheelSegments = [
			{ type: 'discount', label: '20% DESC', value: '20%', color: '#ffb3d1' },    // M√°s claro
			{ type: 'discount', label: '5% DESC', value: '5%', color: '#ffe6f2' },      // Muy claro
			{ type: 'discount', label: '50% DESC', value: '50%', color: '#ff8fb8' },    // Claro
			{ type: 'discount', label: '0% DESC', value: '0%', color: '#fff0f7' },      // El m√°s claro
			{ type: 'discount', label: '30% DESC', value: '30%', color: '#ffa3c7' },    // Claro
			{ type: 'discount', label: '10% DESC', value: '10%', color: '#ffd9ea' },    // Muy claro
			{ type: 'free', label: 'POSTRE GRATIS', value: 'üéÇ', color: '#ff6b9d' },     // El m√°s oscuro (base)
			{ type: 'discount', label: '15% DESC', value: '15%', color: '#ffc6de' },    // Claro
			{ type: 'discount', label: '70% DESC', value: '70%', color: '#ff7ba8' },    // Claro-medio
			{ type: 'discount', label: '25% DESC', value: '25%', color: '#ffb0cf' }     // Claro
		];

		// Initialize
		document.addEventListener('DOMContentLoaded', async () => {
			await loadSellers();
			drawWheel();
			setupEventListeners();
		});

		// Load sellers from API
		async function loadSellers() {
			try {
				const response = await fetch('/.netlify/functions/get-sellers');
				const sellers = await response.json();

				const select = document.getElementById('seller-name');
				sellers.forEach(seller => {
					const option = document.createElement('option');
					option.value = seller.name;
					option.textContent = seller.name;
					select.appendChild(option);
				});
			} catch (error) {
				console.error('Error loading sellers:', error);
				// Fallback sellers
				const select = document.getElementById('seller-name');
				['Vendedor 1', 'Vendedor 2', 'Vendedor 3'].forEach(name => {
					const option = document.createElement('option');
					option.value = name;
					option.textContent = name;
					select.appendChild(option);
				});
			}
		}

		// Draw the wheel
		function drawWheel() {
			const canvas = document.getElementById('wheel-canvas');
			const ctx = canvas.getContext('2d');
			const centerX = canvas.width / 2;
			const centerY = canvas.height / 2;
			const radius = canvas.width / 2;

			const segmentAngle = (2 * Math.PI) / wheelSegments.length;
			// Offset to start at top (12 o'clock) instead of right (3 o'clock)
			const startOffset = -Math.PI / 2;

			wheelSegments.forEach((segment, index) => {
				const startAngle = (index * segmentAngle) + startOffset;
				const endAngle = startAngle + segmentAngle;

				// Draw segment
				ctx.beginPath();
				ctx.moveTo(centerX, centerY);
				ctx.arc(centerX, centerY, radius, startAngle, endAngle);
				ctx.closePath();
				ctx.fillStyle = segment.color;
				ctx.fill();
				ctx.strokeStyle = 'white';
				ctx.lineWidth = 2;
				ctx.stroke();

				// Draw text
				ctx.save();
				ctx.translate(centerX, centerY);
				ctx.rotate(startAngle + segmentAngle / 2);
				ctx.textAlign = 'center';
				ctx.fillStyle = '#2a2a2a';
				ctx.font = 'bold 12px DM Sans';
				ctx.fillText(segment.label, radius * 0.65, 5);
				ctx.restore();
			});
		}

		// Setup event listeners
		function setupEventListeners() {
			document.getElementById('registration-form').addEventListener('submit', handleRegistration);
			document.getElementById('spin-btn').addEventListener('click', handleSpin);
			document.getElementById('share-btn').addEventListener('click', handleShare);
		}

		// Handle registration
		async function handleRegistration(e) {
			e.preventDefault();

			const name = document.getElementById('customer-name').value.trim();
			const whatsapp = document.getElementById('customer-whatsapp').value.trim();
			const seller = document.getElementById('seller-name').value;

			// Validate
			let isValid = true;

			if (!name || name.length < 3) {
				showError('name-error');
				isValid = false;
			} else {
				hideError('name-error');
			}

			if (!whatsapp || !/^\d{10}$/.test(whatsapp)) {
				showError('whatsapp-error');
				isValid = false;
			} else {
				hideError('whatsapp-error');
			}

			if (!seller) {
				showError('seller-error');
				isValid = false;
			} else {
				hideError('seller-error');
			}

			if (!isValid) return;

			// Show loading
			const submitBtn = document.getElementById('submit-btn');
			submitBtn.disabled = true;
			submitBtn.innerHTML = '<span class="spinner"></span>';

			try {
				// Check if already played
				const response = await fetch('/.netlify/functions/game-register', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ name, whatsapp, seller })
				});

				const data = await response.json();

				if (!response.ok) {
					if (data.alreadyPlayed) {
						alert('¬°Ya has jugado antes! Solo puedes jugar una vez.');
					} else {
						alert('Error al registrar. Por favor intenta de nuevo.');
					}
					submitBtn.disabled = false;
					submitBtn.textContent = 'Comenzar a Jugar';
					return;
				}

				// Save state and show game
				gameState.customerName = name;
				gameState.whatsapp = whatsapp;
				gameState.sellerName = seller;

				document.getElementById('registration-section').classList.add('hidden');
				document.getElementById('game-section').classList.add('active');

			} catch (error) {
				console.error('Registration error:', error);
				alert('Error de conexi√≥n. Por favor intenta de nuevo.');
				submitBtn.disabled = false;
				submitBtn.textContent = 'Comenzar a Jugar';
			}
		}

		// Handle spin
		async function handleSpin() {
			if (gameState.hasPlayed) return;

			const spinBtn = document.getElementById('spin-btn');
			spinBtn.disabled = true;

			try {
				// Get prize from server
				const response = await fetch('/.netlify/functions/game-play', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({
						whatsapp: gameState.whatsapp,
						name: gameState.customerName,
						seller: gameState.sellerName
					})
				});

				const data = await response.json();

				if (!response.ok) {
					alert('Error al jugar. Por favor intenta de nuevo.');
					spinBtn.disabled = false;
					return;
				}

				gameState.prize = data.prize;
				gameState.hasPlayed = true;

				// DEBUG: Log what we received from backend
				console.log('Backend prize:', data.prize);
				console.log('Wheel segments:', wheelSegments);

				// Find the prize index - CRITICAL FIX: buscar por label Y value para match exacto
				const prizeIndex = wheelSegments.findIndex(s =>
					s.label === data.prize.label && s.value === data.prize.value
				);

				console.log('First search (label + value):', prizeIndex);

				// Si no se encuentra, buscar solo por label (fallback)
				const finalPrizeIndex = prizeIndex >= 0 ? prizeIndex :
					wheelSegments.findIndex(s => s.label === data.prize.label);

				console.log('Final prize index:', finalPrizeIndex);
				console.log('Matched segment:', wheelSegments[finalPrizeIndex]);

				if (finalPrizeIndex === -1) {
					console.error('Prize not found in wheel segments:', data.prize);
					alert('Error: Premio no encontrado en la ruleta');
					spinBtn.disabled = false;
					return;
				}

				// Calculate rotation to land exactly in the CENTER of the winning segment
				const segmentAngle = 360 / wheelSegments.length;
				const targetAngle = finalPrizeIndex * segmentAngle;
				const spins = 5; // Number of full rotations
				// Add half segment to point to CENTER instead of edge
				const centerOffset = segmentAngle / 2;
				const finalRotation = (spins * 360) + (360 - targetAngle - centerOffset);

				console.log('Segment angle:', segmentAngle);
				console.log('Target angle for index', finalPrizeIndex, ':', targetAngle);
				console.log('Center offset:', centerOffset);
				console.log('Final rotation:', finalRotation);

				// Spin the wheel
				const wheel = document.getElementById('wheel-canvas');
				wheel.style.transform = `rotate(${finalRotation}deg)`;

				// Show prize after animation (4s spin + 3s pause = 7s total)
				setTimeout(() => {
					showPrize(data.prize);
				}, 7000);

			} catch (error) {
				console.error('Spin error:', error);
				alert('Error de conexi√≥n. Por favor intenta de nuevo.');
				spinBtn.disabled = false;
			}
		}

		// Show prize
		function showPrize(prize) {
			document.getElementById('game-section').classList.remove('active');
			document.getElementById('prize-section').classList.add('active');

			// Update prize display
			if (prize.type === 'free') {
				document.getElementById('prize-icon').textContent = 'üéÇ';
				document.getElementById('prize-value').textContent = '¬°POSTRE GRATIS!';
				document.getElementById('prize-message').textContent =
					'¬°Incre√≠ble! Has ganado un postre completamente gratis. Este premio se aplicar√° en tu pr√≥xima compra.';
			} else if (prize.value === '0%') {
				// Special message for 0% discount
				document.getElementById('prize-icon').textContent = 'üòî';
				document.getElementById('prize-value').textContent = prize.value;
				document.getElementById('prize-message').textContent =
					'Lo sentimos, esta vez no hubo suerte. ¬°Esperamos que tengas mejor fortuna la pr√≥xima!';
			} else {
				document.getElementById('prize-icon').textContent = 'üéÅ';
				document.getElementById('prize-value').textContent = prize.value;
				document.getElementById('prize-message').textContent =
					`¬°Felicitaciones! Has ganado un descuento del ${prize.value}. Este descuento se aplicar√° en tu pr√≥xima compra.`;
			}

			// Show confetti
			createConfetti();
		}

		// Create confetti
		function createConfetti() {
			const container = document.getElementById('confetti-container');
			const colors = ['#f4a6b7', '#fbbf24', '#ec4899', '#f472b6', '#fbcfe8'];

			for (let i = 0; i < 50; i++) {
				setTimeout(() => {
					const confetti = document.createElement('div');
					confetti.className = 'confetti';
					confetti.style.left = Math.random() * 100 + '%';
					confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
					confetti.style.animationDelay = Math.random() * 0.5 + 's';
					container.appendChild(confetti);

					setTimeout(() => confetti.remove(), 3000);
				}, i * 30);
			}
		}

		// Handle share
		function handleShare() {
			const prize = gameState.prize;
			const message = prize.type === 'free'
				? `¬°Gan√© un postre GRATIS en Sweet Lab! üéÇüéâ`
				: `¬°Gan√© un ${prize.value} de descuento en Sweet Lab! üéÅüéâ`;

			const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
			window.open(url, '_blank');
		}

		// Helper functions
		function showError(id) {
			document.getElementById(id).classList.add('show');
		}

		function hideError(id) {
			document.getElementById(id).classList.remove('show');
		}
	</script>
</body>

</html>
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Sweet Lab - Ventas</title>
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="/styles.css?v=2025-09-17-1" />
	<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
	<header class="app-header">
		<div class="header-row">
			<div class="header-left">
				<img src="/logo.png" alt="Lulitas Logo" class="app-logo" />
				<h1>Sweet Lab - Registro de ventas</h1>
			</div>
			<div class="header-actions">
				<div id="client-search-container" class="client-search-container">
					<button id="client-search-toggle" class="press-btn client-search-toggle" title="Buscar cliente" aria-label="Buscar cliente"></button>
					<input id="client-search-input" type="text" class="client-search-input" placeholder="Buscar cliente..." autocomplete="off" style="display:none" />
				</div>
				<button id="theme-toggle" class="press-btn theme-toggle" title="Modo oscuro" aria-label="Cambiar tema"></button>
				<button id="logout-btn" class="press-btn" title="Cerrar sesión" style="display:none">Salir</button>
			</div>
		</div>
	</header>

	<main id="app">
		<section id="view-login" class="view">
			<div class="sellers-panel">
				<div class="panel-header"><h3>Iniciar sesión</h3></div>
				<div class="panel-body">
					<div class="login-form">
						<input id="login-user" type="text" placeholder="Usuario" class="input-cell" />
						<input id="login-pass" type="password" placeholder="Contraseña" class="input-cell" />
						<button id="login-btn" class="press-btn btn-primary">Entrar</button>
						<div id="login-error" class="login-error hidden"></div>
						<div class="login-actions">
							<button id="login-change-pass" class="press-btn secondary">Cambiar contraseña</button>
						</div>
					</div>
				</div>
			</div>
		</section>
		<section id="view-select-seller" class="view">
			<div class="sellers-panel">
				<div class="panel-header">
					<h3>Vendedores activos</h3>
				</div>
				<div class="panel-body">
					<div id="seller-list" class="seller-list"></div>
					<div class="seller-add">
						<button id="add-seller" class="press-btn add-seller-wide">Agregar vendedor</button>
						<button id="delete-seller" class="press-btn add-seller-wide">Eliminar vendedor</button>
					</div>
				</div>
			</div>
			<div id="global-dates-section" class="dates-section">
				<div class="report-card">
					<div class="report-card-content">
						<h3 class="report-title">Gestión de reportes</h3>
						<button id="report-button" class="press-btn report-btn btn-primary">Ventas</button>
						<button id="transfers-button" class="press-btn report-btn">Transferencias</button>
						<button id="cartera-button" class="press-btn report-btn">Cartera</button>
					<button id="projections-button" class="press-btn report-btn">Proyecciones</button>
						<button id="materials-button" class="press-btn report-btn">Materiales</button>
						<button id="inventory-button" class="press-btn report-btn">Inventario</button>
						<button id="desserts-button" class="press-btn report-btn">Postres</button>
						<button id="users-button" class="press-btn report-btn">Usuarios</button>
						<button id="accounting-button" class="press-btn report-btn">Contabilidad</button>
						<button id="deliveries-button" class="press-btn report-btn">Entregas</button>
					</div>
				</div>
				<input id="report-date" type="date" class="hidden" />
			</div>
		</section>

		<section id="view-sales" class="view hidden">
			<!-- Dynamic loading indicator -->
			<div id="sales-loading" class="sales-loading-overlay hidden">
				<div class="sales-loading-box">
					<div class="sales-spinner"></div>
					<div class="sales-loading-text" id="sales-loading-text">Cargando ventas...</div>
				</div>
			</div>
			
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="go-home" class="secondary press-btn">Inicio</button>
					</div>
					<h2 id="current-seller"></h2>
					<div class="toolbar-actions">
						<button id="undo-btn" class="secondary press-btn" title="Deshacer" aria-label="Deshacer"></button>
						<button id="redo-btn" class="secondary press-btn" title="Rehacer" aria-label="Rehacer"></button>
						<button id="date-new" class="press-btn btn-primary">+ Nueva Fecha</button>
					</div>
				</div>
			</div>

			<div id="dates-section" class="dates-section">
				<div class="clients-actions"><button id="clients-button" class="press-btn">Clientes</button><button id="archive-button" class="press-btn" title="Ver archivo" aria-label="Ver archivo">Archivo</button></div>
				<div class="dates-list" id="dates-list"></div>
				<input id="new-date" type="date" class="hidden" />
			</div>

			<div class="sales-panel">
				<div class="panel-header">
					<h3 id="sales-title">Registro de Ventas de Postres</h3>
					<div class="panel-actions">
						<button id="add-row" class="press-btn btn-primary">Nuevo pedido</button>
						<button id="export-excel" class="excel-btn press-btn btn-gold">⤓ Exportar Excel</button>
					</div>
				</div>
				<div class="panel-body">
					<div class="table-wrapper hidden" id="sales-wrapper">
				<table id="sales-table">
					<caption id="sales-caption"><strong></strong></caption>
					<colgroup id="sales-table-colgroup">
						<col class="w-paid" />
						<col class="w-client" />
						<!-- Dessert cols will be inserted dynamically here -->
						<col class="w-total" />
						<col class="w-actions" />
					</colgroup>
					<thead>
						<tr id="sales-table-header">
							<th class="col-paid">$</th>
							<th class="col-client">Cliente</th>
							<!-- Dessert columns will be inserted dynamically here -->
							<th class="col-total">Total</th>
							<th class="col-actions"></th>
						</tr>
					</thead>
					<tbody id="sales-tbody"></tbody>
					<tfoot id="sales-table-footer">
						<tr class="tfoot-qty" id="footer-qty-row">
							<td class="col-paid"></td>
							<td class="col-client label">Totales</td>
							<!-- Dessert qty columns will be inserted dynamically here -->
							<td class="col-total"><span id="sum-total-qty"> </span></td>
							<td class="col-actions"></td>
						</tr>
						<tr class="tfoot-amt" id="footer-amt-row">
							<td class="col-paid"></td>
							<td class="col-client label"></td>
							<!-- Dessert amt columns will be inserted dynamically here -->
							<td class="col-total"><span id="sum-grand">0</span></td>
							<td class="col-actions"></td>
						</tr>
						<tr class="tfoot-amt-stack t-am-grand">
							<td class="col-paid"></td>
							<td class="col-client" colspan="7"></td>
							<td class="col-total"><span class="st-amt st-grand" id="sum-grand-2"></span></td>
							<td class="col-actions"></td>
						</tr>
						<tr class="tfoot-delivered" id="footer-delivered-row">
							<td class="col-paid"></td>
							<td class="col-client label">Postres entregados</td>
							<!-- Dessert delivered columns will be inserted dynamically here -->
							<td class="col-total"><span id="deliv-total">0</span></td>
							<td class="col-actions"></td>
						</tr>
						<tr class="tfoot-comm" id="footer-comm-row">
							<td class="col-paid"></td>
							<td class="col-client label">Comisiones</td>
							<!-- Dessert comm columns will be inserted dynamically here -->
							<td class="col-total"><span id="sum-comm">0</span></td>
							<td class="col-actions"></td>
						</tr>
						<!-- Stacked rows will be inserted dynamically here -->
					</tfoot>
				</table>
				<div class="table-actions end">
					
				</div>
			</div>
		</section>

		<section id="view-ingredients" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="ingredients-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Ingredientes</h2>
					<div class="toolbar-actions">
						<button id="ingredients-add-dessert" class="press-btn btn-primary">+ Postre</button>
						<button id="ingredients-add-extras" class="press-btn">Extras</button>
					</div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Recetas por postre</h3>
				</div>
				<div class="panel-body">
					<div id="ingredients-content"></div>
				</div>
			</div>
		</section>

		<section id="view-measures" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="measures-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Producción</h2>
					<div class="toolbar-actions"></div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Cantidades por postre</h3>
				</div>
				<div class="panel-body">
					<div id="measures-content"></div>
				</div>
			</div>
		</section>

		<section id="view-inventory" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="inventory-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Inventario</h2>
					<div class="toolbar-actions"></div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Ingredientes y saldos</h3>
				</div>
				<div class="panel-body">
					<div id="inventory-content"></div>
				</div>
			</div>
		</section>

		<section id="view-inventory-adjust" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="inventory-adjust-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Ajustes de Inventario</h2>
					<div class="toolbar-actions"></div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Ajustes</h3>
				</div>
				<div class="panel-body">
					<div id="inventory-adjust-content"></div>
				</div>
			</div>
		</section>

		<section id="view-inventory-history" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="inventory-history-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Historial de Inventario</h2>
					<div class="toolbar-actions"></div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Movimientos recientes</h3>
				</div>
				<div class="panel-body">
					<div id="inventory-history-content"></div>
				</div>
			</div>
		</section>

		<section id="view-clients" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="clients-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Clientes</h2>
					<div class="toolbar-actions"></div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Todos los clientes</h3>
				</div>
				<div class="panel-body">
					<div class="table-wrapper" id="clients-wrapper">
						<table id="clients-table" class="clients-table">
							<thead>
								<tr>
									<th>Cliente</th>
									<th class="col-qty"># Registros</th>
								</tr>
							</thead>
							<tbody id="clients-tbody"></tbody>
						</table>
					</div>
				</div>
			</div>
		</section>

		<section id="view-client-detail" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="client-detail-back" class="secondary press-btn">Volver</button>
					</div>
					<h2 id="client-detail-title">Cliente</h2>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3 id="client-detail-subtitle">Historial de compras</h3>
					<div class="panel-actions">
						<button id="client-detail-add-order" class="press-btn btn-primary">Nuevo pedido</button>
					</div>
				</div>
				<div class="panel-body">
					<div class="table-wrapper" id="client-detail-wrapper">
						<table id="client-detail-table">
							<thead>
								<tr>
									<th class="col-paid">$</th>
									<th class="col-date">Fecha</th>
									<th class="col-arco">Arco</th>
									<th class="col-melo">Melo</th>
									<th class="col-mara">Mara</th>
									<th class="col-oreo">Oreo</th>
									<th class="col-nute">Nute</th>
									<th class="col-total">Total</th>
									<th></th>
								</tr>
							</thead>
							<tbody id="client-detail-tbody"></tbody>
							<tfoot>
								<tr>
									<td></td>
									<td class="label">Totales</td>
									<td id="client-detail-total-arco"></td>
									<td id="client-detail-total-melo"></td>
									<td id="client-detail-total-mara"></td>
									<td id="client-detail-total-oreo"></td>
									<td id="client-detail-total-nute"></td>
									<td id="client-detail-total-grand" class="col-total"></td>
									<td></td>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</section>

		<section id="view-times" class="view hidden">
			<div class="header-sticky">
				<div class="toolbar">
					<div class="toolbar-left">
						<img src="/logo.png" alt="Lulitas Logo" class="app-logo toolbar-logo" />
						<button id="times-back" class="secondary press-btn">Volver</button>
					</div>
					<h2>Tiempos</h2>
					<div class="toolbar-actions">
						<button id="times-add-dessert" class="press-btn btn-primary">+ Postre</button>
					</div>
				</div>
			</div>
			<div class="sales-panel">
				<div class="panel-header">
					<h3>Recetas locales con cronómetros</h3>
				</div>
				<div class="panel-body">
					<div id="times-content"></div>
				</div>
			</div>
		</section>
	</main>

	<footer class="app-footer">
		<small>Datos sincronizados con Netlify + Neon</small>
	</footer>

	<!-- Toast container -->
	<div id="toast-container" aria-live="polite" aria-atomic="true"></div>

	<script src="/app.js?v=2025-11-04-1" type="module"></script>
</body>
</html>